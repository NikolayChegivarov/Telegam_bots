# Legal_report — Telegram-бот для юридической отчетности

**Legal_report** — это Telegram-бот, позволяющий сотрудникам быстро сформировать юридический отчет на основании данных из типовых выгрузок: Word, PDF и Excel. Отчет создается автоматически в формате Word по заданному шаблону.

## ⚙️ Как работает бот

1. **Авторизация** — пользователь должен быть одобрен администратором.
2. **Кнопка "Создать отчет"**:
   - Бот поочередно запрашивает 3 файла:
     1. Word — «Выгрузка Контур.Фокус»
     2. PDF — «Финансовая выгрузка из Контур.Фокус»
     3. Excel — «Выгрузка арбитражных производств»
   - После загрузки всех файлов запускается автогенерация отчета.
3. **Результат**:
   - Готовый Word-документ отправляется пользователю;
   - Сохраняется в папку `Reports/`;
   - Название организации сохраняется в `history_requests.json`.

## 💾 Требования

Установите зависимости:

```bash
pip install -r requirements.txt
```

## 📦 Структура проекта

Legal_report/  
├── bot/  
│ ├── main.py # Точка входа — запуск и маршрутизация команд  
│ ├── messages.py # Тексты сообщений (при необходимости)  
│ ├── state_machine.py # Управление этапами загрузки файлов  
│ ├── handlers/ # Обработчики команд и кнопок  
│ │ ├── authorization.py  
│ │ ├── blocking.py  
│ │ ├── report.py  
│ │ ├── history.py  
│ │ └── fallback.py  
│  
├── database/  
│ ├── database_interaction.py # Работа с PostgreSQL (проверка и авторизация)  
│ └── create_database.py # Создание таблиц и БД  
│  
├── utils/  
│ ├── extraction.py # Извлечение данных из Word, PDF, Excel  
│ ├── recording_data.py # Запись данных в шаблон Word  
│ ├── file_checks.py # Проверка форматов и расширений  
│  
├── history/  
│ ├── history_manager.py # Работа с файлом истории  
│ └── history_requests.json # Журнал созданных отчетов  
│  
├── Reports/ # Готовые отчеты (*.docx)  
├── temp/ # Временные загруженные пользователем файлы  
│  
├── views_docs/ # Примеры типовых файлов  
│ ├── word.docx  
│ ├── pdf.pdf  
│ ├── excel.xlsx  
│ ├── views_word_file.py  
│ └── views_PDF_file.py  
│  
├── шаблон.docx # Шаблон итогового документа  
├── .env # Переменные окружения (токен, данные БД)  
├── requirements.txt # Зависимости проекта  
└── README.md # Описание проекта  
  
📁 Переменные окружения (.env)  
TELEGRAM_TOKEN_BOT=...  
HOST=...  
DB_PORT=...  
DB_NAME=...  
DB_USER=...  
DB_PASSWORD=...  
ADMIN=123456789   # Telegram ID администратора  

🚀 Запуск
python bot/main.py

📌 Примечания
Временные файлы пользователя автоматически сохраняются в папку temp/ и удаляются после генерации.  
Для локальной отладки структуры файлов можно использовать views_docs/views_word_file.py и views_PDF_file.py.  
